- if spree_current_user.admin?
  = render 'spree/admin/shared/configuration_menu'

= content_for :page_title do
  = t("admin.enterprise_ratings.index.title", default: "Opinie o sprzedawcach")

%table.index#listing_enterprise_ratings
  %thead
    %tr
      %th= t("admin.enterprise_ratings.index.enterprise", default: "Sprzedawca")
      %th= t("admin.enterprise_ratings.index.order", default: "Zamowienie")
      %th= t("admin.enterprise_ratings.index.buyer", default: "Kupujacy")
      %th= t("admin.enterprise_ratings.index.rating", default: "Ocena")
      %th= t("admin.enterprise_ratings.index.comment", default: "Komentarz")
      %th= t("admin.enterprise_ratings.index.created_at", default: "Utworzono")
      %th= t("admin.enterprise_ratings.index.status", default: "Status")
      %th.actions
  %tbody
    - @ratings.each do |rating|
      %tr
        %td= rating.enterprise.name
        %td= link_to rating.order.number, spree.edit_admin_order_path(rating.order)
        %td= rating.order.bill_address&.full_name || rating.order.email
        %td= rating.rating
        %td= rating.comment
        %td= l(rating.created_at, format: :short)
        %td
          - if rating.removed_at.present?
            %span= t("admin.enterprise_ratings.index.removed", default: "Usunieta")
            - if rating.removal_reason.present?
              %div= rating.removal_reason
          - elsif rating.excluded_from_stats?
            %span= t("admin.enterprise_ratings.index.excluded", default: "Wykluczona")
          - elsif rating.removal_requested_at.present?
            %span= t("admin.enterprise_ratings.index.removal_requested", default: "Prosba o usuniecie")
          - else
            %span= t("admin.enterprise_ratings.index.active", default: "Aktywna")
        %td.actions
          - if spree_current_user.admin?
            - if rating.removed_at.present?
              = button_to t("admin.enterprise_ratings.index.restore", default: "Przywroc"), main_app.restore_admin_enterprise_rating_path(rating),
                          method: :patch, class: "button secondary admin-action-button"
            - else
              = button_to t("admin.enterprise_ratings.index.remove", default: "Usun"), main_app.remove_admin_enterprise_rating_path(rating),
                          method: :patch, class: "button secondary admin-action-button",
                          params: { removal_reason: t("admin.enterprise_ratings.index.default_removal_reason", default: "Usunieta przez admina") }
            - if rating.excluded_from_stats?
              = button_to t("admin.enterprise_ratings.index.include", default: "Uwzglednij"), main_app.include_admin_enterprise_rating_path(rating),
                          method: :patch, class: "button secondary admin-action-button"
            - else
              = button_to t("admin.enterprise_ratings.index.exclude", default: "Wyklucz"), main_app.exclude_admin_enterprise_rating_path(rating),
                          method: :patch, class: "button secondary admin-action-button",
                          params: { excluded_reason: "duplicate_recent" }
          - elsif rating.removal_requestable?(spree_current_user)
            = button_to t("admin.enterprise_ratings.index.request_removal", default: "Popros o usuniecie"), main_app.request_removal_admin_enterprise_rating_path(rating),
                        method: :patch, class: "button secondary admin-action-button"
